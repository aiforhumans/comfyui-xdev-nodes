"""
Test Phase 1 Implementation - Auto-registration system
"""

import sys
sys.path.append('..')

try:
    from xdev_nodes import NODE_CLASS_MAPPINGS, NODE_DISPLAY_NAME_MAPPINGS
    from xdev_nodes.categories import NodeCategories
    
    print("üöÄ PHASE 1 STATUS CHECK")
    print("=" * 50)
    
    # Test auto-registration
    print(f"‚úÖ Auto-registration successful!")
    print(f"üìä Registered {len(NODE_CLASS_MAPPINGS)} nodes")
    print(f"üìã Display names: {len(NODE_DISPLAY_NAME_MAPPINGS)} entries")
    
    # Test categories
    print(f"\nüè∑Ô∏è CATEGORY SYSTEM:")
    print(f"‚úÖ NodeCategories class available")
    print(f"üìö Available categories: {len(NodeCategories.get_all_categories())}")
    
    # Sample nodes
    print(f"\nüîç SAMPLE REGISTERED NODES:")
    for i, (node_id, display_name) in enumerate(NODE_DISPLAY_NAME_MAPPINGS.items()):
        print(f"  {node_id} ‚Üí {display_name}")
        if i >= 4:
            print(f"  ... and {len(NODE_DISPLAY_NAME_MAPPINGS)-5} more")
            break
    
    # Test specific functionality
    print(f"\nüß™ FUNCTIONALITY TESTS:")
    
    # Check if categories are being used
    category_usage = {}
    for node_id, node_class in NODE_CLASS_MAPPINGS.items():
        category = getattr(node_class, 'CATEGORY', 'Unknown')
        category_usage[category] = category_usage.get(category, 0) + 1
    
    print(f"üìà Category usage:")
    for category, count in sorted(category_usage.items()):
        print(f"  {category}: {count} nodes")
    
    # Check for NodeCategories usage
    using_constants = sum(1 for cat in category_usage.keys() 
                         if not cat.startswith('"') and cat in NodeCategories.get_all_categories())
    
    print(f"\nüìä PHASE 1 COMPLETION:")
    print(f"  ‚úÖ Auto-registration: IMPLEMENTED")
    print(f"  ‚úÖ Centralized categories: IMPLEMENTED")
    print(f"  üìà Nodes using category constants: {using_constants}/{len(NODE_CLASS_MAPPINGS)}")
    
    if using_constants > len(NODE_CLASS_MAPPINGS) * 0.8:
        print(f"  üéâ PHASE 1: COMPLETE!")
    else:
        print(f"  ‚ö†Ô∏è PHASE 1: PARTIALLY COMPLETE (need to migrate remaining categories)")

except ImportError as e:
    print(f"‚ùå Import failed: {e}")
    print("‚ö†Ô∏è Phase 1 not fully implemented yet")
except Exception as e:
    print(f"‚ùå Error: {e}")